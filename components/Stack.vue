<template>
    <div class="relative flex justify-center py-100 s:py-200 mb-50 s:mb-100">
        <div ref="centre" class="aspect relative w-[15rem] s:w-[37.5rem]" style="--aspect: 350/460;">
            <div class="absolute top-[-20%] left-[-125%] js-line">
                <svg class="w-[1.25rem] s:w-[2.5rem] h-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.749 21.762">
                    <path fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="4.5" d="M5.874 3.377C17.736 8.763 9.809 16.652 20.559 17.37" />
                </svg>
            </div>
            <div class="absolute top-[-15%] left-[-25%] js-line">
                <svg class="w-[1.25rem] s:w-[2.5rem] h-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.749 21.762">
                    <path fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="4.5" d="M5.874 3.377C17.736 8.763 9.809 16.652 20.559 17.37" />
                </svg>
            </div>
            <div class="absolute bottom-[-15%] left-[-115%] js-line">
                <svg class="w-[1.25rem] s:w-[2.5rem] h-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.749 21.762">
                    <path fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="4.5" d="M5.874 3.377C17.736 8.763 9.809 16.652 20.559 17.37" />
                </svg>
            </div>
            <div class="absolute bottom-[-20%] right-[-175%] js-line">
                <svg class="w-[1.25rem] s:w-[2.5rem] h-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.749 21.762">
                    <path fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="4.5" d="M5.874 3.377C17.736 8.763 9.809 16.652 20.559 17.37" />
                </svg>
            </div>
            <div class="absolute top-[-5%] right-[-75%] js-line">
                <svg class="w-[1.25rem] s:w-[2.5rem] h-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.749 21.762">
                    <path fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="4.5" d="M5.874 3.377C17.736 8.763 9.809 16.652 20.559 17.37" />
                </svg>
            </div>
            <div class="absolute top-[-10%] left-[-75%] js-line">
                <svg class="w-[3rem] s:w-[5.6rem] h-auto" viewBox="0 0 60.79 68.88" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="m46.35 52.07c7.89-5.1 19.03-17.01 12.45-31.27-.02-.05-.05-.1-.08-.16-1.93-3.45-8.32-9-18.67-5.35-.13.04-.25.1-.37.17-.48.27-1.55.89-2.31 1.16 0-.4.07-1.05.3-2.03 1.14-5.03-.93-10.55-4.92-13.13-3.56-2.3-7.91-1.86-11.93 1.2-.1.07-.19.16-.27.25-.01 0-1.02 1.04-2.76.08-6.81-3.79-11.92-1.55-14.48 1.84-.88.99-4.33 5.71-.4 15.48-1.59 2.02-4.15 6.36-2.22 11.65.3 1.64 2.12 7.98 12.47 9.94-.23 1.32-.46 3.06-.52 4.95-.19 5.63 1.16 9.71 4 12.12.68.68 3.76 3.45 8.98 3.61h.5c5.26 0 10.87-2.58 16.73-7.68 3.15 4.11 6.31 8.69 8.6 12.81.41.74 1.18 1.16 1.97 1.16.37 0 .74-.09 1.09-.28 1.09-.6 1.48-1.97.87-3.06-2.35-4.22-5.68-9.07-9.05-13.47zm-20.45 6.02c-3.93-.08-5.98-2.2-6.05-2.28s-.16-.16-.24-.23c-3.71-3.05-2.4-11.85-1.58-14.98.17-.63.05-1.31-.32-1.85s-.96-.89-1.61-.96c-10.12-1.09-10.94-6.43-10.97-6.61-.02-.21-.07-.42-.14-.61-1.73-4.45 1.95-8.04 2.1-8.18.71-.66.91-1.69.52-2.57-3.85-8.53-1.04-11.86-.96-11.95.08-.08.16-.17.22-.26.69-.94 1.98-2.11 4.13-2.11 1.23 0 2.75.38 4.6 1.41 3.65 2.03 6.76.47 8.05-.76 1.74-1.29 4.27-2.45 6.66-.91 2.38 1.53 3.69 5.2 2.97 8.35-.5 2.22-.93 5.35 1.21 6.94 2.28 1.69 5.33.04 7.24-1.06 8.8-3 12.62 2.64 13.03 3.31 6.11 13.44-7.53 23.36-11.22 25.73-1.13-1.38-2.23-2.68-3.27-3.83-.02-.06-.03-.12-.05-.18-2.37-5.79 4.4-12.42 4.47-12.49.89-.86.92-2.28.06-3.18s-2.28-.93-3.18-.07c-.28.27-5.18 5.04-6.18 11.04-3.17-3.15-7.17-10.84-8.52-13.7-.53-1.12-1.87-1.61-2.99-1.08s-1.61 1.87-1.08 2.99c.57 1.2 5.66 11.86 10.23 15.72 1.62 1.37 4.21 4.18 7.04 7.64-5.12 4.47-9.99 6.77-14.16 6.71z" />
                </svg>
            </div>
            <div class="absolute bottom-[-15%] right-[-25%] js-line">
                <svg class="w-[4rem] s:w-[7.6rem] h-auto" viewBox="0 0 81.31 106.2" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M81.14 10.11c-.56-3.87-2.63-7.23-5.54-8.98a.405.405 0 0 0-.09-.05c-7.09-3.81-14.66 3.3-20.18 8.5l-1.13 1.06C43.11 20.97 38.94 29.91 41.79 37.23c.7 1.79 1.78 3.3 3.05 4.58C35.48 51.21 2.77 91.59.2 97.23c-.37.8-.23 1.75.35 2.41l5.06 5.79c.43.49 1.05.77 1.69.77.11 0 .22 0 .33-.02.76-.11 1.41-.6 1.72-1.3 2.56-5.63 12.91-20.2 22.04-33.05C41.47 57.65 47.2 49.44 49.49 45.1c2.63 1.31 5.28 1.92 7.02 1.93h.07c5.4 0 10.68-3.37 15.27-9.75a54.094 54.094 0 0 0 8.32-17.45c.72-2.63 1.48-6.11.96-9.73ZM27.73 69.23C19.4 80.95 10.83 93.01 6.84 100l-1.85-2.11c3.22-5.07 15.43-20.53 26.29-33.66-1.2 1.7-2.4 3.38-3.55 5Zm48.11-50.57a49.843 49.843 0 0 1-7.63 16.01c-2.59 3.6-6.7 7.88-11.62 7.88h-.05c-2.24-.01-8.67-2.1-10.57-6.95-2.09-5.35 1.81-12.84 11.28-21.66l1.15-1.08c4.02-3.78 8.87-8.33 12.83-8.33.73 0 1.43.16 2.1.5 1.74 1.07 3 3.21 3.36 5.73.31 2.19.05 4.62-.84 7.91Z" />
                </svg>
            </div>
            <figure v-for="(item, i) in items" :key="i" ref="slide"
                class="absolute inset-0 media-fill radius-fix rounded-[4.5rem] s:rounded-[9rem] overflow-hidden">
                <img :src="item.image.url">
            </figure>
        </div>
    </div>
</template>

<script>
import gsap from 'gsap'

import { qsa, rect } from '~/assets/js/utils/common'

export default {
    props: {
        items: {
            type: Array,
            required: true,
        }
    },

    computed: {

        hasMouse() {
            return this.$store.state.app.features.hasMouse
        }
    },

    async mounted() {
        await this.$nextTick()

        const { top, left, width, height } = rect(this.$refs.centre)
        const lc = left + width / 2
        const tc = top + height / 2

        this.lines = qsa('.js-line', this.$el).map(line => {
            const r = rect(line)
            const ld = r.left - lc
            const td = r.top - tc
            const rotation = gsap.utils.random(0, 360)

            return { line, ld, td, rotation }
        })

        this.hasMouse ? (this.st = gsap.timeline({
            scrollTrigger: {
                trigger: this.$el,
                start: 'center center',
                end: () => `+=${this.$r.wh}`,
                pin: true,
                scrub: .25,
            },
            defaults: {
                duration: 1,
                ease: 'power1.inOut'
            }
        })) : (this.st = gsap.timeline({
            scrollTrigger: {
                trigger: this.$el,
                start: 'top center',
            },
            defaults: {
                duration: 1.25,
                ease: 'expo.inOut'
            }
        }))

        this.st
            .to(this.$refs.slide[0], {
                xPercent: -225,
                rotation: -3
            }, 0)
            .to(this.$refs.slide[1], {
                xPercent: -100,
                yPercent: 25
            }, 0)
            .to(this.$refs.slide[2], {
                rotation: 10
            }, 0)
            .to(this.$refs.slide[3], {
                xPercent: 225,
                rotation: 3
            }, 0)
            .to(this.$refs.slide[4], {
                xPercent: 140,
                rotation: -3,
                yPercent: 25
            }, 0)

        this.lines.forEach(({ line, ld, td, rotation }) => {
            this.st
                .from(line, {
                    x: -ld,
                    y: -td,
                    duration: 1.25,
                    ease: 'power2.inOut'
                }, 0)
                .to(line, {
                    rotation,
                    duration: 1.25,
                    ease: 'power2.inOut'
                }, 0)
        })
    },

    destroyed() {
        this.st?.kill()
    }
}
</script>
